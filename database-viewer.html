<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Viewer - Formularze</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .status {
            flex: 1;
            text-align: right;
            color: #666;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .table-section {
            margin-bottom: 40px;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .table-title {
            font-size: 1.5rem;
            color: #333;
            font-weight: 700;
        }
        
        .badge {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #dee2e6;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            color: #555;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
            font-style: italic;
        }
        
        .json-cell {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            font-size: 18px;
            color: #666;
        }
        
        .error {
            background: #fee;
            color: #c33;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #c33;
        }
        
        .success {
            background: #efe;
            color: #3c3;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #3c3;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üóÑÔ∏è Database Viewer</h1>
            <div class="subtitle">PrzeglƒÖdarka danych formularzy</div>
        </header>
        
        <div class="controls">
            <button onclick="loadData()">üîÑ Od≈õwie≈º dane</button>
            <button onclick="exportToJSON()">üíæ Eksportuj JSON</button>
            <button onclick="window.open('/', '_blank')">üè† Powr√≥t do aplikacji</button>
            <div class="status" id="status">Kliknij "Od≈õwie≈º dane"</div>
        </div>
        
        <div class="content" id="content">
            <div class="loading">Kliknij przycisk "Od≈õwie≈º dane" aby za≈Çadowaƒá zawarto≈õƒá bazy danych</div>
        </div>
    </div>

    <script>
        let currentData = null;
        
        async function loadData() {
            const content = document.getElementById('content');
            const status = document.getElementById('status');
            
            content.innerHTML = '<div class="loading">‚è≥ ≈Åadowanie danych...</div>';
            status.textContent = '≈Åadowanie...';
            
            try {
                const response = await fetch('http://localhost:3001/api/admin/all-data');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message);
                }
                
                currentData = data;
                displayData(data);
                
                const totalRecords = Object.values(data.tables).reduce((sum, table) => sum + table.count, 0);
                status.innerHTML = `
                    <strong>${data.database}</strong> ‚Ä¢ 
                    ${totalRecords} rekord√≥w ‚Ä¢ 
                    ${new Date(data.timestamp).toLocaleString('pl-PL')}
                `;
            } catch (error) {
                content.innerHTML = `
                    <div class="error">
                        <strong>‚ùå B≈ÇƒÖd:</strong> ${error.message}<br>
                        Upewnij siƒô, ≈ºe backend dzia≈Ça na porcie 3001
                    </div>
                `;
                status.textContent = 'B≈ÇƒÖd po≈ÇƒÖczenia';
            }
        }
        
        function displayData(data) {
            const content = document.getElementById('content');
            const tables = data.tables;
            
            let html = '';
            
            const tableNames = {
                'eksperymenty': 'üî¨ Eksperymenty (podstawowe)',
                'eksperymenty_extended': 'üî¨ Eksperymenty (rozszerzone)',
                'osoby': 'üë§ Osoby',
                'form_submissions': 'üìù Formularze og√≥lne'
            };
            
            for (const [tableName, tableData] of Object.entries(tables)) {
                html += `
                    <div class="table-section">
                        <div class="table-header">
                            <div class="table-title">${tableNames[tableName] || tableName}</div>
                            <div class="badge">${tableData.count} rekord√≥w</div>
                        </div>
                `;
                
                if (tableData.count === 0) {
                    html += '<div class="no-data">Brak danych w tej tabeli</div>';
                } else {
                    const records = tableData.data;
                    const columns = Object.keys(records[0]);
                    
                    html += '<table><thead><tr>';
                    columns.forEach(col => {
                        html += `<th>${col}</th>`;
                    });
                    html += '</tr></thead><tbody>';
                    
                    records.forEach(record => {
                        html += '<tr>';
                        columns.forEach(col => {
                            let value = record[col];
                            
                            // Formatowanie warto≈õci
                            if (value === null || value === undefined) {
                                value = '<em style="color: #999;">null</em>';
                            } else if (typeof value === 'string' && (value.startsWith('{') || value.startsWith('['))) {
                                value = `<div class="json-cell" title="${value}">${value}</div>`;
                            } else if (col.includes('date') || col.includes('at')) {
                                try {
                                    value = new Date(value).toLocaleString('pl-PL');
                                } catch (e) {}
                            }
                            
                            html += `<td>${value}</td>`;
                        });
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table>';
                }
                
                html += '</div>';
            }
            
            content.innerHTML = html;
        }
        
        function exportToJSON() {
            if (!currentData) {
                alert('Najpierw za≈Çaduj dane!');
                return;
            }
            
            const blob = new Blob([JSON.stringify(currentData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `database_export_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Auto-load on page load
        window.addEventListener('load', () => {
            loadData();
        });
    </script>
</body>
</html>
